{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/lxc/Projects/aiagent/sweatshop_id_card/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from 'react';\nimport { signIn, signOut, useSession } from 'next-auth/react';\nimport Image from 'next/image';\nimport Link from 'next/link';\n\nexport default function Home() {\n  const { data: session, status } = useSession();\n  const [position, setPosition] = useState('TP 志愿者');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [badgeUrl, setBadgeUrl] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  // 登录处理\n  const handleSignIn = async () => {\n    try {\n      setError(null);\n      await signIn('twitter', { callbackUrl: '/' });\n    } catch (err) {\n      console.error('登录失败:', err);\n      setError('登录过程中出现错误，请重试');\n    }\n  };\n\n  const handleGenerateBadge = async () => {\n    if (!session) {\n      setError('请先登录以生成徽章');\n      return;\n    }\n\n    setIsGenerating(true);\n    setError(null);\n    \n    try {\n      console.log('正在生成徽章，用户信息:', {\n        name: session.user?.name,\n        image: session.user?.image,\n        position\n      });\n      \n      const response = await fetch('/api/generate-badge', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ position }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || '生成徽章失败');\n      }\n\n      const blob = await response.blob();\n      const url = URL.createObjectURL(blob);\n      setBadgeUrl(url);\n    } catch (error: any) {\n      console.error('生成徽章错误:', error);\n      setError(error.message || '生成徽章失败，请重试');\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  // 清理资源\n  useEffect(() => {\n    return () => {\n      if (badgeUrl) {\n        URL.revokeObjectURL(badgeUrl);\n      }\n    };\n  }, [badgeUrl]);\n\n  return (\n    <main className=\"flex min-h-screen flex-col items-center justify-between p-8 md:p-24\">\n      <div className=\"z-10 max-w-5xl w-full flex flex-col items-center justify-center\">\n        <h1 className=\"text-4xl md:text-6xl font-bold mb-8 text-center\">血汗工厂 SWEATSHOP</h1>\n        <h2 className=\"text-xl md:text-2xl mb-12 text-center\">厂友好，帮你做个ID卡</h2>\n\n        {error && (\n          <div className=\"w-full max-w-md mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\">\n            <p>{error}</p>\n          </div>\n        )}\n\n        <div className=\"w-full max-w-md bg-white p-8 rounded-lg shadow-md\">\n          {status === 'loading' ? (\n            <div className=\"flex justify-center\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n            </div>\n          ) : session ? (\n            <div className=\"flex flex-col items-center gap-6\">\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"relative w-16 h-16 rounded-full overflow-hidden bg-gray-200\">\n                  {session.user?.image && (\n                    <Image\n                      src={session.user.image}\n                      alt={session.user.name || 'User'}\n                      fill\n                      className=\"object-cover\"\n                    />\n                  )}\n                </div>\n                <div>\n                  <h3 className=\"text-xl font-semibold\">{session.user?.name || 'Twitter用户'}</h3>\n                  <p className=\"text-gray-600 text-sm\">\n                    已通过Twitter验证 \n                    <span className=\"ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full\">\n                      ✓ 已登录\n                    </span>\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"w-full\">\n                <label htmlFor=\"position\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Position (职位)\n                </label>\n                <input\n                  type=\"text\"\n                  id=\"position\"\n                  value={position}\n                  onChange={(e) => setPosition(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n              </div>\n\n              <div className=\"flex flex-col md:flex-row gap-3 w-full\">\n                <button\n                  onClick={handleGenerateBadge}\n                  disabled={isGenerating}\n                  className=\"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50\"\n                >\n                  {isGenerating ? '生成中...' : '生成徽章'}\n                </button>\n                <button\n                  onClick={() => signOut()}\n                  className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\"\n                >\n                  退出登录\n                </button>\n              </div>\n\n              {badgeUrl && (\n                <div className=\"mt-6 flex flex-col items-center\">\n                  <div className=\"relative w-72 h-96 mb-4 border border-gray-200 rounded\">\n                    <Image src={badgeUrl} alt=\"Generated Badge\" fill className=\"object-contain\" />\n                  </div>\n                  <a\n                    href={badgeUrl}\n                    download=\"sweatshop-badge.png\"\n                    className=\"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\"\n                  >\n                    下载徽章\n                  </a>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center gap-6\">\n              <p className=\"text-center text-lg mb-4\">\n                通过Twitter登录，生成属于你的SWEATSHOP工厂ID卡\n              </p>\n              <button\n                onClick={handleSignIn}\n                className=\"bg-blue-400 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-2 focus:outline-none focus:shadow-outline\"\n              >\n                <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" stroke=\"currentColor\" fill=\"none\">\n                  <path d=\"M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z\"></path>\n                </svg>\n                登录 Twitter\n              </button>\n              <div className=\"mt-4 text-sm text-gray-500 text-center\">\n                我们只使用你的公开资料信息来生成徽章\n              </div>\n            </div>\n          )}\n        </div>\n        \n\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}